## 1. 文件概述

**文件名**: `stations.json`  
**用途**: 
存储RIA|ZTH服务器中所有车站的基础信息，包括位置、所属线路和换乘关系等
此为测试版，暂时只保存了海华铁路局的车站数据
**维护者**: AutMoonWhite
**更新日期**: 2025-12-13
**版本**: 1.0.0

## 2. 数据结构总览

本JSON文件为**数组结构**，包含多个车站对象：

```jsonc
[
  {
    "stationName": "普通车站",   //车站名称
    "lines": [                  //经行线路数据
      {
        "bureau": "R",          //路局代码
        "line": "1",            //线路编号
        "stationCode": 1,       //车站编号；取值为1表示此为上行起点车站
        "coord": { "x": 100.0, "y": 64.0, "z": 100.0 },
        //车站坐标，依次为x坐标、y坐标、z坐标
        "distance": 25.0        //站台距离区间起点的长度
      }
    ]
  },

  {
    "stationName": "换乘车站",
    "lines": [
      //多条线经过该站，将所有经行线路数据分别存入lines列表
      {
        "bureau": "R",
        "line": "1",
        "stationCode": 2,
        "coord": { "x": 200.0, "y": 64.0, "z": 100.0 },
        "distance": 100.0       //距离上一站的里程
      },
      {
        "bureau": "R",
        "line": "2",
        "stationCode": 7,
        "coord": { "x": 200.0, "y": 64.0, "z": 64.0 },
        "distance": -1.0        //本线路暂未开通
      },
      {
        "bureau": "R",
        "line": "3",
        "stationCode": 2,
        "coord": { "x": 200.0, "y": 64.0, "z": 132.0 },
        /*"distance": 166.0*/
        //距离可以通过简单的曼哈顿距离计算得出，因此可以省略
      }
    ],

    "specialCases": [ //特殊情况
      {
        "type": "directionNotAvaliable",  //方向未开通
        "target": {                       //无法前往R3-1
          "bureau": "R",
          "line": "3",
          "isTrainUp": true               //上行方向“未开通”
        }
      },
/*
      {
        "type": "lineNotAvaliable",       //线路未开通
        "target": {                       //R2线未开通，不能乘坐
          "bureau": "R",
          "line": "2"
        }
      },
*/
      //lineNotAvaliable 可以通过distance=-1.0的情况确定，因此可以省略；必须使用的情况详见3.4
      {
        "type": "skipStation",            //跳过车站
        "target": {                       //R1线不停R1-3，下一个停靠的站为R1-4
          "bureau": "R",
          "line": "1",
          "stationCode": 4                //4为下一个停靠车站的编号
        }
      }
    ]
  }
]
```
以上数据（仅包括左起第一个“普通车站”与“换乘车站”）对应的参考配线图：
![](./车站数据示例配线图.png)
## 3 字段详细说明

### 3.1 车站对象 (Station Object)
| 字段名 | 类型 | 必需 | 说明 | 示例 |
|--------|------|------|------|------|
| `stationName` | string | √ | 车站唯一名称 | "普通车站" |
| `lines` | array | √ | 该站经行线路列表 | 见3.2 |
| `specialCases` | array | × | 特殊情况列表 | 见3.4 |

**部分字段详细解释：**
**stationName**
车站的唯一名称。
如果遇上车站重名的情况，在车站后加上路局代码以示区分。如在铁路局A和B中均有名为“主城”的车站，则需要分别命名为“主城A”“主城B”。

### 3.2 线路信息对象 (Line Info Object)
| 字段名 | 类型 | 必需 | 说明 | 示例 |
|--------|------|------|------|------|
| `bureau` | string | √ | 路局代码 | "R" |
| `line` | string | √ | 线路编号 | "1", "A", "2b" |
| `stationCode` | integer | √ | 车站在该线路上的序号 | 1, 2, 10 |
| `coord` | object | √ | 车站坐标 | 见3.3 |
| `distance` | float | × | 距离上一站的距离 | 100.0 |

**部分字段详细解释：**
**bureau**
每个铁路局申领的、独有的字母代码。
路局代码列表：
| 路局代码 | 路局名称 |
|--------|------|
| R | ZTH轨道交通结社（社营铁路） |
| H | 海华铁路局 |

**stationCode**
车站在该线路上的序号。一个车站可能有着不止一个序号，因为它跟铁路线路有关而非车站本身。
此表中的stationCode与实际上的编号可能有出入，由于：
* 算法中根据车站序号±1来确定上一站/下一站，序号为1时为起点站。
如果-1/+1没查找到车站，算法将其理解为这是这个**区间**的起点/终点站。
如果出现越行情况，参见3.4中的lineOvertaking类特殊状况。

**distance**
指距离上一站的距离。特殊情况如下：
| 取值 | 含义 |
|--------|------|
| 0.0 | 本站为区间起点 |
| -1.0 | 该线路在本站未开通 |

* 如果距离可以通过简单的曼哈顿距离计算得出或者未测定，该参数可以省略。
对于留空的情况，算法会自动计算曼哈顿距离。
* 如果<code>stationCode==1</code>，那么该距离可表示站台从上行起点起算的里程。
这个数据在寻路算法计算长度时无关紧要，但是可能用于未来的更多算法，比如计算后续站点在全线的里程数等。

* 此外，Y轴差距（高度差）不参与铁路里程计算。

### 3.3 坐标对象 (Coordinate Object)
| 字段名 | 类型 | 必需 | 说明 | 示例 |
|--------|------|------|------|------|
| `x` | float | √ | X坐标 | 100.0 |
| `y` | float | √ | Y坐标 | 64.0 |
| `z` | float | √ | Z坐标 | 200.0 |

### 3.4 特殊情况对象 (Special Case Object)
| 字段名 | 类型 | 必需 | 说明 | 示例 |
|--------|------|------|------|------|
| `type` | string | √ | 特殊情况类型 | directionNotAvaliable |
| `target` | object | √ | 特殊情况目标 | 见下 |

特殊情况分四种：
| 值 | 释义 | 说明
|--------|------|-|
| directionNotAvaliable | 方向未开通 | 线路的某个方向未开通 |
| lineNotAvaliable | 线路未开通 | 线路在这个车站未开通（可由其他因素确定，详见释义） |
| lineOvertaking | 越行运营 | 前方若干车站越行，下一站的编号并非本站编号±1 |
| throughTrain | 贯通运行 | 列车无换乘行驶到其他线路 |

在这些情况下，对象target中的字段与含义不同：

**directionNotAvaliable**（方向未开通）
| 字段名 | 类型 | 必需 | 说明 | 示例 |
|--------|------|------|------|------|
| `bureau` | string | √ | 未开通线路的路局代码 | "R" |
| `line` | string | √ | 未开通线路的线路编号 | "3" |
| `isTrainUp` | boolean | √ | 未开通方向是否为上行 | true |

对象指向的车站不能在本站乘车到达。

该情况适用于以下两种状况：
* 单向行驶的支线铁路，即示例中给出的R3线；
* 本站和下一站都在运营，但是连接两个站之间的线路未通车。
※当且仅当涉及的车站编号相邻时使用。
举例：如果R1-4和R1-5都在运营，但是两个站之间没有通车，则需要使用本特殊情况。
在R1-4站，三个字段分别为<code>"R"</code><code>"1"</code><code>false</code>；
在R1-5站，三个字段分别为<code>"R"</code><code>"1"</code><code>true</code>。
但是如果R1-4已开通，R1-5未开通，R1-6已开通，那在R1-5的数据没有存入stations.json的情况下，不需要添加此特殊情况，因为算法找不到R1-5，自动认为R1-4是区间终点。

**lineNotAvaliable**（线路未开通）
*途径车站线路未开通的情况可以根据distance=-1.0来确定，因此大部分情况下可以省略；
当且仅当车站为该线路的下行起点站（里程确定）但线路未开通时，这个特殊情况才是必需的。*
| 字段名 | 类型 | 必需 | 说明 | 示例 |
|--------|------|------|------|------|
| `bureau` | string | √ | 未开通线路的路局代码 | "R" |
| `line` | string | √ | 未开通线路的线路编号 | "2" |

对象指向的线路在本站尚未开通。
原则上未开通的线路不应录入本数据库；在已开通线路因故暂停运营时，可以用此特殊情况进行标记。
在不考虑构建邻接表算法运行时间的情况下，如果该线路的上下站均没有录入数据库，即使线路未开通也可省略此项，因为寻路算法找不到这条线路的邻接车站。

**lineOvertaking**（越行运营）
| 字段名 | 类型 | 必需 | 说明 | 示例 |
|--------|------|------|------|------|
| `bureau` | string | √ | 越行运营线路的路局代码 | "R" |
| `line` | string | √ | 越行运营线路的线路编号 | "1" |
| `stationCode` | integer | √ | 越行运营线路停靠的下一站 | 4 |

对象指向的车站为越行运营方向的下一个**停靠站点**。

**throughTrain**（贯通运行）
| 字段名 | 类型 | 必需 | 说明 | 示例 |
|--------|------|------|------|------|
| `bureau1` | string | √ | 贯通运行中一条线的路局代码 | "R" |
| `line1` | string | √ | 贯通运行中一条线的线路编号 | "1" |
| `bureau2` | string | √ | 贯通运行中另一条线的路局代码 | "R" |
| `line2` | string | √ | 贯通运行中另一条线的线路编号 | "2" |

对象指向的两条线路贯通运营，线路顺序无关紧要。在计算换乘时，这两条线路之间的换乘权重应当视为0。

## 4 graph构建与寻路算法备忘录

* 构建graph时可先读取specialCases，并将读取结果存入某处，下一步寻找邻接线路/车站时跟该列表比较，如果重合则阻止该节点存入邻接表的过程，转而寻找下一个节点。
* 进行上述比较时注意判断上下行（根据target的站点编号和当前站编号确定需要特殊处理的是上行还是下行），以防删错方向。

